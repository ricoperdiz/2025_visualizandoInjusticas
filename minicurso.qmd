---
encoding: "UTF-8"

title: "Visualizando injusti√ßas"
subtitle: "Introdu√ß√£o ao R para an√°lise e apresenta√ß√£o de dados"

date: "04 Dec 2025"

format:
  revealjs:
    theme: serif
    slide-number: "c/t"
    show-slide-number: print
    incremental: true
    chalkboard: true
    # multiplex: true

execute:
  echo: true

---

```{r}
#| include: false
dimensoes <- data.table::fread(
  "dados-brutos/disque100-primeiro-semestre-2020.csv",
  na.strings = c("", "NA", "NULL")
) |>
  janitor::clean_names() |>
  dim()
dimensoes
```


## Sum√°rio {.scrollable}

+ Apresenta√ß√£o pessoal

+ Dados do minicurso

+ Instala√ß√£o e carregamento de pacotes em R

+ Importando dados

+ Checagem de dados

+ Limpeza e checagem

+ Manipula√ß√£o de dados

+ Visualiza√ß√£o

+ Lidando com textos

---


## Ricardo Perdiz

:::: {.columns}

::: {.column width="40%"}

```{r}
#| out-width: "90%"
#| echo: false
knitr::include_graphics("img/eu.JPG")
```

:::

::: {.column width="60%"}
Doutorado e mestrado em Ci√™ncias Biol√≥gicas (Bot√¢nica) - INPA e UEFS

üíò Plantas, linguagens, an√°lise de dados üíò 
:::

::::

# Dados deste minicurso

+ [Dados das den√∫ncias de viola√ß√£o de direitos humanos recebidas pelo Disque 100, a partir de 2020 registradas junto √† central de atendimento da Ouvidoria Nacional de Direitos Humanos ‚Äì ONDH](https://dados.gov.br/dados/conjuntos-dados/ouvidoria-nacional-de-direitos-humanos--ondh#:~:text=Primeiro%20semestre%20de%202020).  

+ Primeiro semestre de 2020.  

+ Vers√£o reduzida - 1000 linhas.  

+ Conjunto original - `r dimensoes[1]` linhas üò±üò±üò± e `r dimensoes[2]` colunas

# Pacotes em R

+ Milhares de **pacotes** que estendem suas funcionalidades

+ CRAN  

+ Instala√ß√£o e carregamento de pacotes  

# `install.packages()` VS. `library()`

+ Instalamos pacotes R **uma vez apenas**, para cada vers√£o de R que tivermos instalado no computador

+ Cada sess√£o nova de R - `library()`

# Instalando pacotes

```{r}
#| eval: false
#| echo: true
# Instalar (executar uma √∫nica vez)
install.packages("dplyr")
install.packages("ggplot2")
install.packages("readxl")
```

# Carregando pacotes

```{r}
#| echo: true
# Carregar
library("dplyr")
library("ggplot2")
library("readxl")
```

# Pacote `dplyr`

```{r}
#| eval: true
#| echo: false
knitr::include_url(
  "https://www.ricardoperdiz.com/blog/2020-04-08-basertidyverse/"
)
```

::: aside
[[https://www.ricardoperdiz.com/blog/2020-04-08-basertidyverse/](https://www.ricardoperdiz.com/blog/2020-04-08-basertidyverse/)]{.bg-blue .white}
:::

# Pacote ggplot2

# Pacote readxl

# üß≥ Importando dados üé≤

## Arquivos `CSV`

```{r}
#| echo: false
dados_2020_01 <-
  read.table(
    "dados/disque100-primeiro-semestre-2020_1000Linhas-versaoReduzida.csv",
    sep = ",",
    dec = ".",
    header = TRUE
  )
dados_2020_01
```

```{r}
dados_2020_01 <-
  read.table(
    "disque100-primeiro-semestre-2020_1000Linhas-versaoReduzida.csv",
    sep = ",",
    dec = ".",
    header = TRUE
  )
dados_2020_01
```

---

## Arquivos `xlsx`

```{r}
#| include: false
dados_2020_01 <-
  read_excel(
    "dados/disque100-primeiro-semestre-2020_1000Linhas-versaoReduzida.xlsx"
  )
```

Podemos ler arquivos `xlsx` utilizando a fun√ß√£o `read_excel()` do pacote `readxl` [@readxl]:

```{r}
#| eval: false
dados_2020_01 <-
  read_excel(
    "disque100-primeiro-semestre-2020_1000Linhas-versaoReduzida.xlsx"
  )
```

---

## Resultado da importa√ß√£o de dados 

+ Quando executamos a fun√ß√£o `read.table()`, podemos acabar vendo muita coisa, o que pode acabar [incomodando]{.purple}  

+ `head()`

---

## {.scrollable}

```{r}
dados_2020_01 <-
  read.table(
    "dados/disque100-primeiro-semestre-2020_1000Linhas-versaoReduzida.csv",
    sep = ",",
    dec = ".",
    header = TRUE
  )
head(dados_2020_01)
```

# Impress√£o concisa dos dados no console

## {.scrollable}

```{r}
dados_2020_01 <-
  read_excel(
    "dados/disque100-primeiro-semestre-2020_1000Linhas-versaoReduzida.xlsx"
  )
dados_2020_01
```

# Busquem saber a diferen√ßa entre um `data.frame` e um `tibble`

---

## Outras formas de importar dados tabulares

+ Fun√ß√µes do pacote base: `read.csv()`, `read.delim()`, `readLines()`

+ `data.table::fread()`, `readr::read_delim()`

# Inspe√ß√£o b√°sica

+ Diversas formas de inspecionar os dados

+ `head()`, `tail()`, `str()`, `summary()` e `dplyr::glimpse()`

# `tail()` == √∫ltimas linhas

```{r}
tail(dados_2020_01)
```

# `str()` == estrutura

```{r}
str(dados_2020_01)
```

# `summary()` == sum√°rio estat√≠stico

```{r}
summary(dados_2020_01)
```

# `dim()` == dimens√µes

```{r}
dim(dados_2020_01)
```

# `dplyr::glimpse()` == vers√£o da fun√ß√£o `str()`

```{r}
dplyr::glimpse(dados_2020_01)
```

# Uma inspe√ß√£o mais a fundo ...

## Pacote [skimr](https://docs.ropensci.org/skimr/) {.scrollable}

```{r}
library("skimr")
skim(dados_2020_01)
```

# üßπ Limpeza e checagem de dados üëÄ

+ Dados do mundo real raramente s√£o perfeitos  

+ Precisamos limp√°-los  

+ **Dados ausentes (NA):**  

+ **Tipos de colunas:**  

# Dados ausentes

## Identificando valores ausentes

```{r}
is.na(dados_2020_01)
```

---

## Quantos valores ausentes?

```{r}
sum(is.na(dados_2020_01))
```

# Removendo linhas com NA

+ fun√ß√£o `na.omit()`  

---

## {.scrollable}

```{r}
na_removido <- na.omit(dados_2020_01)
```

---

## Checando os dados ap√≥s a remo√ß√£o das linhas

```{r}
glimpse(na_removido)
```

# Ajuda para entender uma determinada fun√ß√£o

+ `?FUNCAO`

+ A chamada **ajuda** [*help*]

---

## Exemplos de ajuda

```{r}
#| eval: false
#| echo: true
?read.table
?na.omit
?c
?summary
```


# üõ†Ô∏è Manipula√ß√£o e transforma√ß√£o de dados ü™õ com dplyr

## Pacote `dplyr` ü™õ

+ Parte do [tidyverse](https://tidyverse.org/)

+ [@dplyr] facilita a manipula√ß√£o de dados com verbos simples e encade√°veis

---

## Fun√ß√µes com nomes f√°ceis de memorizar

```{r}
#| eval: false
# Filtrando dados
dados_2020_01 |>
  filter(estado == "Roraima")

# Selecionando colunas
dados_2020_01 |>
  select(denunciante)

# Criando novas vari√°veis
mutate(dados_2020_01, e_roraima = ifelse(estado == "Roraima", "sim", "n√£o"))
```

# Operador pipe `|>`

+ L√™-se ‚Äúent√£o‚Äù

+ Ele envia o resultado de uma etapa para a pr√≥xima, tornando o c√≥digo mais leg√≠vel.

---

## Leia o c√≥digo abaixo

```{r}
#| eval: false
dados_2020_01 |> filter(estado == "Roraima")
```

---

## O significado disso √©

> ‚Äúpegue `dados_2020_01`, ent√£o filtre apenas as linhas em que o estado de ocorr√™ncia √© Roraima.

# Fun√ß√µes importantes

+ `select()`: Escolhe colunas  

+ `filter()`: Filtra linhas  

+ `mutate()`: Cria novas colunas ou altera existentes  

+ `group_by()` e `summarize()`: Agrupa dados para fazer resumos  

---

## Filtragem de dados - `dplyr::filter()`

```{r}
dados_2020_01 |>
  filter(estado == "Roraima")
```

## Sele√ß√£o de colunas - `dplyr::select()`

```{r}
dados_2020_01 |>
  select(denuncia_emergencial)
```

---

## Podemos selecionar mais de uma coluna

```{r}
dados_2020_01 |>
  select(cenario_da_violacao, denuncia_emergencial)
```

---

## Cria√ß√£o de novas colunas - `dplyr::mutate()` {.scrollable}

```{r}
dados_2020_01 |>
  mutate(
    e_roraima = ifelse(estado == "Roraima", "sim", "n√£o")
  ) |>
  select(e_roraima)
```

---

## Agrupamento e sumariza√ß√£o de dados - `group_by()` e `summarise()` {.scrollable}

```{r}
dados_2020_01 |>
  group_by(estado) |>
  summarise(
    n = n()
  )
```

---

## `dplyr::count()`

```{r}
dados_2020_01 |>
  count(estado)
```

# üìà Visualiza√ß√£o de dados üìä

+ Linguagem desenhada para visualizar dados

+ Possibilidades infinitas - quem determina o limite √© o usu√°rio

+ `ggplot2` [@Wickham2016] - uma "gram√°tica de gr√°ficos" [@Wilkinson2005]

+ Alguns exemplos utilizar√£o outro conjunto de dados - [`mtcars`](https://www.rdocumentation.org/packages/datasets/versions/3.6.2/topics/mtcars)

---

## Fun√ß√µes b√°sicas do pacote `ggplot2`


+ `ggplot()`: Define os dados e a est√©tica (`aes()`).  

+ `geom_*`: Adiciona as camadas geom√©tricas (pontos: `geom_point()`; barras: `geom_col()`; linhas: `geom_line()`).

# Histograma

```{r}
ggplot(mtcars, aes(x = mpg)) +
  geom_histogram()
```

---

## Outros argumentos

```{r}
ggplot(mtcars, aes(x = mpg)) +
  geom_histogram(binwidth = 10, fill = "skyblue", color = "black")
```

# Visualizando rela√ß√µes entre vari√°veis

```{r}
ggplot(mtcars, aes(x = wt, y = mpg)) +
  geom_point()
```

---

```{r}
ggplot(mtcars, aes(x = wt, y = mpg)) +
  geom_point(size = 5) +
  theme(axis.text = element_text(size = 16))
```

# Explorando rela√ß√µes complexas

Podemos adicionar mais vari√°veis aos nossos gr√°ficos usando a est√©tica.

+ `color`: Mapeia uma vari√°vel categ√≥rica para a cor.  

+ `facet_wrap()` e `facet_grid()`: Cria sub-gr√°ficos para cada categoria.  

---

## Cores em vari√°veis - I

```{r}
ggplot(data = mtcars, aes(x = hp, y = mpg, col = disp)) +
  geom_point()
```

---

## Cores em vari√°veis - II

```{r}
ggplot(data = mtcars, aes(x = hp, y = mpg, col = gear)) +
  geom_point(size = 5)
```

---

## Cores em vari√°veis - III

```{r}
ggplot(data = mtcars, aes(x = hp, y = mpg, col = as.factor(gear))) +
  geom_point(size = 4)
```

# Gr√°ficos de facetas

+ Facilitam a visualiza√ß√£o de dados por grupos

+ Duas fun√ß√µes que produzem as facetas

+ `facet_wrap()`, quando voc√™ quer visualizar dados por apenas uma vari√°vel  

+ `facet_grid()`, que deve ser utilizada quando voc√™ quer ver a combina√ß√£o entre duas vari√°veis  

# `facet_wrap()`

```{r}
ggplot(mtcars, aes(wt, mpg)) +
  geom_point() +
  facet_wrap(~am)
```

# `facet_grid()`

```{r}
ggplot(mtcars, aes(wt, mpg)) +
  geom_point() +
  facet_grid(am ~ cyl)
```

# Gr√°fico de barras com `geom_col()`

## {.scrollable}

```{r}
dados_2020_01 |>
  count(estado) |>
  filter(n > 40) |>
  ggplot(aes(x = estado, y = n, fill = estado)) +
  geom_col() +
  labs(title = "Top 5 estados brasileiros com maior n√∫mero de ocorr√™ncias")
```

# Lidando com textos!

```{r}
library("tidytext")
library("tibble")
```

---

## {.scrollable}

```{r}
palavras_violacoes <-
  dados_2020_01 |>
  rownames_to_column() |>
  rename(id_denuncia = rowname) |>
  unnest_tokens(output = palavra, input = violacoes)
```

---

## {.scrollable}

:::: {.columns}

::: {.column width = "50%"}
```{r}
dados_2020_01 |>
  select(violacoes)
```
:::

::: {.column width = "50%"}


```{r}
palavras_violacoes |>
  select(palavra)
```

:::

::::


---

:::: {.columns}

::: {.column width = "30%"}

```{r}
#| eval: false
#| echo: true
palavras_violacoes |>
  select(id_denuncia, palavra) |>
  filter(grepl("violencia", palavra)) |>
  count(palavra) |>
  # arrange(desc(n))]
  filter(n > 306) |>
  ggplot(aes(x = palavra, y = n)) +
  geom_col() +
  labs(
    title = "Top 5 tipos de viol√™ncia mais frequentes\n no Disque 100 em 2020.1"
  ) +
  theme(axis.text.x = element_text(angle = 45))
```

:::

::: {.column width = "70%"}

```{r}
#| eval: true
#| echo: false
palavras_violacoes |>
  select(id_denuncia, palavra) |>
  filter(grepl("violencia", palavra)) |>
  count(palavra) |>
  # arrange(desc(n))]
  filter(n > 306) |>
  ggplot(aes(x = palavra, y = n)) +
  geom_col() +
  labs(
    title = "Top 5 tipos de viol√™ncia mais frequentes\n no Disque 100 em 2020.1"
  ) +
  theme(axis.text.x = element_text(angle = 45))
```

:::

::::

---

## {.center}

```{r}
#| eval: true
#| echo: false
palavras_violacoes |>
  select(id_denuncia, palavra) |>
  filter(grepl("violencia", palavra)) |>
  count(palavra) |>
  # arrange(desc(n))]
  filter(n > 306) |>
  ggplot(aes(x = palavra, y = n)) +
  geom_col() +
  labs(
    title = "Top 5 tipos de viol√™ncia mais frequentes\n no Disque 100 em 2020.1"
  ) +
  theme(axis.text.x = element_text(angle = 45))
```

---

# An√°lise quantitativa de textos

+ [quanteda](https://quanteda.io/index.html)

+ [topicmodels](https://cran.r-project.org/web/packages/topicmodels/vignettes/topicmodels.pdf)

---

# Conclus√£o e pr√≥ximos passos

## **Onde seguir a partir daqui?** {.scrollable}

+ **Aprofunde-se na linguagem R**  [@VicentiniPerdiz2021].  

+ **Modelagem estat√≠stica** 

+ **Comunica√ß√£o e visualiza√ß√£o interativa** [shiny](https://shiny.posit.co/), [flexdashboard](https://pkgs.rstudio.com/flexdashboard/), [rmarkdown](https://rmarkdown.rstudio.com/), [quarto](https://quarto.org/).  


# Grato!

![](https://media.giphy.com/media/v1.Y2lkPWVjZjA1ZTQ3NmlqdmY2emJtOWt6YzM4OXlhNWV5ZzJqcXFxNGo2YXVuMmp0bWg0dCZlcD12MV9naWZzX3NlYXJjaCZjdD1n/7DzlajZNY5D0I/giphy.gif)

::: aside
<ricoperdiz@gmail.com>
:::

---

## Refer√™ncias

::: {#refs}
:::

